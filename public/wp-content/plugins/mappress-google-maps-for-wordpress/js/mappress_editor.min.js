var mapp=window.mapp||{};mapp.Media=function(){function u(i){n=i;jQuery("#mapp_m_editor").empty();jQuery("#mapp_m_editor").append(r.clone());var u=n.getMapid();u?jQuery("#mapp_m_mapid").text(u):jQuery("#mapp_m_mapid").text("");jQuery("#mapp_m_title").val(n.getTitle());jQuery("#mapp_m_width").val(n.getWidth());jQuery("#mapp_m_height").val(n.getHeight());jQuery("#mapp_m_edit_panel").show();jQuery("#mapp_m_list_panel").hide();t=new mapp.Editor(n)}function f(){t.close();n=null;t=null;jQuery("#mapp_m_edit_panel").hide();jQuery("#mapp_m_list_panel").show()}function o(){mapp.Map.ajaxCreate("mapp_edit",i,function(n){u(n)})}function s(n){mapp.Map.ajaxGet(n,"mapp_edit",i,function(n){u(n)})}function h(n){var t='[mappress mapid="'+n+'"]';send_to_editor(t)}function e(){if(n){var t=jQuery.trim(jQuery("#mapp_m_title").val());t=t!=""?t:mappl10n.untitled;n.setTitle(t);n.ajaxSave(function(n){n.list&&jQuery("#mapp_m_maplist").html(n.list);f()})}}function c(n){confirm(mappl10n.delete_map_prompt)&&(jQuery("#mapp_m_maplist tr[data-mapid='"+n+"']").remove(),mapp.Map.ajaxDelete(n))}var t,n,r,l=this,i;r=jQuery("#mapp_m_editor").contents().detach();i={bicycling:!1,directions:"none",editable:!0,initialOpenInfo:!1,iwDisableAutoPan:!1,iwType:"ib",mapTypeControl:!0,mapTypeControlStyle:2,mapTypeIds:null,navigationControlOptions:{style:0},overviewMapControl:!1,overviewMapControlOptions:{opened:!1},streetViewControl:!1,traffic:!1,transit:!1};jQuery("#mapp_m_list_panel").show();jQuery("#mapp_m_add_map").click(function(){return o(),!1});jQuery("#mapp_m_maplist").on("click","tr",function(n){var t=jQuery(this).attr("data-mapid");return jQuery(n.target).hasClass("mapp-maplist-edit")?(s(t),!1):jQuery(n.target).hasClass("mapp-maplist-delete")?(c(t),!1):jQuery(n.target).hasClass("mapp-maplist-insert")?(h(t),!1):void 0});jQuery(".mapp-m-size").click(function(){var n=jQuery(this).data("width"),i=jQuery(this).data("height");return jQuery("#mapp_m_width").val(n),jQuery("#mapp_m_height").val(i),t.resize(n,i),!1});jQuery("#mapp_m_width, #mapp_m_height").change(function(){var n=jQuery("#mapp_m_width").val(),i=jQuery("#mapp_m_height").val();return t.resize(n,i),!1});jQuery("#publish, #post-preview").click(function(){e()});jQuery("#mapp_m_save").click(function(){return e(),!1});jQuery("#mapp_m_title").keypress(function(n){if(n.which==13)return n.preventDefault(),jQuery("#mapp_m_save").click(),!1});jQuery("#mapp_m_cancel").click(function(){return f(),!1});jQuery("#mapp_m_insert").click(function(){var t=n.getMapid(),i='[mappress mapid="'+n.getMapid()+'"]';return t?send_to_editor(i):alert(mappl10n.save_first),!1});this.getMap=function(){return n}};mapp.Editor=function(n){function l(){s=jQuery("#mapp_e_infobox").detach();t=n;t.display();this.resize(t.getWidth(),t.getHeight());i();typeof mappl10n.id!="undefined"&&(r=new google.maps.drawing.DrawingManager({circleOptions:u,drawingControlOptions:{drawingModes:[google.maps.drawing.OverlayType.MARKER,google.maps.drawing.OverlayType.POLYGON,google.maps.drawing.OverlayType.POLYLINE,google.maps.drawing.OverlayType.RECTANGLE,google.maps.drawing.OverlayType.CIRCLE]},polygonOptions:u,polylineOptions:u,rectangleOptions:u}),r.setMap(t.getMap()),google.maps.event.addListener(r,"overlaycomplete",function(n){b(n)}));t.getGeocoder().autocompleteField("#mapp_e_saddr","#mapp_e_saddr_err","#mapp_e_search","#mapp_e_myloc",y);google.maps.event.addListener(t,"poicontent",a);google.maps.event.addListener(t,"poidomready",v);jQuery("#mapp_e_recenter").click(function(){return t.closeInfoWindow(),t.autoCenter(!0),!1});google.maps.event.addListener(t.getMap(),"click",function(n){jQuery("#mapp_e_latlng").text(n.latLng.toUrlValue())})}function i(){for(var r=t.getPois(),u="<table>",n=0;n<r.length;n++){var f=r[n].title.replace(/\'/g,"&rsquo;"),e=r[n].getImage("mapp-e-icon"),o=r[n].address;u+="<tr id='"+n+"'><td>"+e+"<\/td><td style='width:100%'><a href='#' title='"+o+"'><b>"+f+"<\/b><\/a><div class='mapp-e-actions'><a href='#' class='mapp-e-poi-list-zoom' data-idx='"+n+"'>"+mappl10n.zoom+"<\/a> | <a href='#' class='mapp-e-poi-list-delete' data-idx='"+n+"'>"+mappl10n.del+"<\/a><\/div><\/td><\/tr>"}u+="<\/table>";jQuery("#mapp_e_poi_list").html(u);jQuery("#mapp_e_poi_list tbody").sortable({axis:"y",placeholder:"mapp-e-sortable-placeholder",forcePlaceholderSize:!0,delay:200,update:function(){var n=jQuery("#mapp_e_poi_list tbody").sortable("toArray");t.sortPois(n);i()}});jQuery("#mapp_e_poi_list tr").click(function(n){var r=jQuery(this).attr("id"),i;return jQuery(n.target).hasClass("mapp-e-poi-list-zoom")?(i=t.getPoi(r),i&&i.zoomIn(),!1):jQuery(n.target).hasClass("mapp-e-poi-list-delete")?(i=t.getPoi(r),i&&g(i),!1):(t.getPoi(r).click(),!1)})}function a(n,t){var i=jQuery(s).clone(),r;jQuery("#mapp_e_poi_title",i).val(n.title);jQuery("#mapp_e_poi_body",i).val(n.body);jQuery("#mapp_e_poi_iconid",i).val(n.iconid);n.isPoly()&&(n.type=="polyline"?jQuery("#mapp_e_poi_polyline_fields",i).show():jQuery("#mapp_e_poi_polyline_fields, #mapp_e_poi_polygon_fields",i).show(),r=n.getColors(),jQuery("#mapp_stroke_color",i).val(r.strokeColor),jQuery("#mapp_stroke_weight",i).val(r.strokeWeight),jQuery("#mapp_stroke_opacity",i).val(parseInt(r.strokeOpacity*100)),jQuery("#mapp_fill_color",i).val(r.fillColor),jQuery("#mapp_fill_opacity",i).val(parseInt(r.fillOpacity*100)));n.type=="kml"&&(jQuery("#mapp_e_poi_kml_fields",i).show(),jQuery("#mapp_e_poi_kml_url",i).val(n.overlay.getUrl()));t.content=i}function v(n){var r={title:n.title,body:n.body,iconid:n.iconid,colors:n.getColors()};k();jQuery("#mapp_e_poi_title").focus();n.isPoly()?(jQuery("#mapp_stroke_color, #mapp_fill_color, #mapp_stroke_weight, #mapp_stroke_opacity, #mapp_fill_opacity").change(function(){var t={strokeColor:jQuery("#mapp_stroke_color").val(),strokeWeight:parseInt(jQuery("#mapp_stroke_weight").val()),strokeOpacity:jQuery("#mapp_stroke_opacity").val()/100};n.type!="polyline"&&(t.fillColor=jQuery("#mapp_fill_color").val(),t.fillOpacity=jQuery("#mapp_fill_opacity").val()/100);n.setColors(t);u=t}),jQuery("#mapp_stroke_color, #mapp_fill_color").mappColorpicker({})):jQuery("#mapp_e_poi_iconid").mappIconPicker({dialog:jQuery("#mapp_e_poi_icon_picker"),open:function(){jQuery("#mapp_e_poi_fields").hide()},close:function(t){jQuery("#mapp_e_poi_fields").show();typeof t!="undefined"&&(f=t,n.iconid=t,n.setIcon(t),i())}});google.maps.event.addListenerOnce(t.getInfoWindow(),"closeclick",function(){jQuery("#mapp_colorpicker").hide();n.title=jQuery("#mapp_e_poi_title").val();n.body=jQuery("#mapp_e_poi_body").val();i()});jQuery("#mapp_e_save_poi").click(function(){return t.closeInfoWindow(),!1});jQuery("#mapp_e_cancel_poi").click(function(){return t.closeInfoWindow(),n.title=r.title,n.body=r.body,n.iconid=r.iconid,n.setIcon(r.iconid),n.setColors(r.colors),i(),!1})}function y(n){if(n){if(n.geometry){var t=mapp.Geocoder.parseAddress(n.formatted_address),i=n.name?n.name:t.firstLine,r=n.name?t.firstLine+", "+t.secondLine:t.secondLine,u=new mapp.Poi({address:n.formatted_address,body:r,iconid:f,overlay:new google.maps.Marker({position:n.geometry.location}),title:i,type:null,viewport:n.geometry.viewport?n.geometry.viewport:null});e(u,!0);return}if(n instanceof google.maps.LatLng)return w(n);if(typeof n=="string"&&n.substring(0,4)=="http")return p(n);alert("Internal error, unable to add location")}}function p(n){var t=new mapp.Poi({iconid:f,overlay:new google.maps.KmlLayer(n,{suppressInfoWindows:!0}),title:"KML",type:"kml"});google.maps.event.addListener(t.overlay,"status_changed",function(){var r=t.overlay.getStatus(),n;r=="OK"?(n=t.overlay.getMetadata(),t.title=n.name,t.body=n.description,t.viewport=t.overlay.getDefaultViewport(),i()):alert(mappl10n.kml_error+":"+r)});e(t,!0)}function w(n){poi=new mapp.Poi({body:"",iconid:f,overlay:new google.maps.Marker({position:n}),title:n.toUrlValue(4)});e(poi,!0)}function b(n){var t;r.setDrawingMode(null);switch(n.type){case"polygon":case"polyline":case"circle":case"rectangle":t=new mapp.Poi({body:"",colors:u,iconid:"poly",overlay:n.overlay,title:mappl10n.shape,type:n.type});break;case"marker":default:t=new mapp.Poi({body:"",iconid:null,overlay:n.overlay,title:n.overlay.getPosition().toUrlValue(4),type:null})}e(t,!1)}function e(n,u){t.closeInfoWindow();r&&r.setDrawingMode(null);t.insertPoi(n);u&&n.center(!0);i()}function k(){typeof tinyMCE!="undefined"&&typeof tinyMCE.init!="undefined"&&(d(),o&&h(),jQuery("#mapp_e_visual").click(function(){h();o=!0}),jQuery("#mapp_e_html").click(function(){c();o=!1}),google.maps.event.addListenerOnce(t.getInfoWindow(),"closeclick",function(){tinyMCE.get("mapp_e_poi_body")&&(tinyMCE.get("mapp_e_poi_body").save(),c())}))}function d(){var i="en",t,n;typeof window.tinyMCEPreInit!="undefined"&&typeof window.tinyMCEPreInit.mceInit!="undefined"&&typeof window.tinyMCEPreInit.mceInit.content!="undefined"&&(t=window.tinyMCEPreInit.mceInit.content,i=typeof t.language!="undefined"?t.language:"en");n={mode:"none",height:"175px",convert_urls:!1,language:i,menubar:!1,plugins:"paste,wplink,textcolor,image",relative_urls:!1,remove_script_host:!1,statusbar:!1,theme:"modern",toolbar1:"formatselect,forecolor,bold,italic,alignleft,aligncenter,alignright,link,unlink,image",toolbar2:"",toolbar3:"",toolbar4:""};tinyMCE.majorVersion<"4"&&(oldOpts={plugins:"paste",skin:"wp_theme",theme:"advanced",theme_advanced_toolbar_location:"top",theme_advanced_buttons1:"formatselect, forecolor,|,bold,italic,|,justifyleft,justifycenter,justifyright,|,link,unlink,|,image,separator,undo,redo",theme_advanced_buttons2:"",theme_advanced_buttons3:""},n=jQuery.extend(n,oldOpts));tinyMCE.init(n)}function h(){tinyMCE.majorVersion>="4"?tinyMCE.execCommand("mceAddEditor",!1,"mapp_e_poi_body"):tinyMCE.execCommand("mceAddControl",!1,"mapp_e_poi_body")}function c(){tinyMCE.majorVersion>="4"?tinyMCE.execCommand("mceRemoveEditor",!1,"mapp_e_poi_body"):tinyMCE.execCommand("mceRemoveControl",!1,"mapp_e_poi_body")}function g(n){return t.closeInfoWindow(),confirm(mappl10n.delete_prompt)?(t.removePoi(n),i(),!0):!1}var r,s,f=null,u={fillColor:"#9FC6E7",fillOpacity:.5,strokeColor:"#0000FF",strokeOpacity:1,strokeWeight:2},o=!0,t=n;this.close=function(){t.closeInfoWindow()};this.resize=function(n,i){t.resize(n,i);t.closeInfoWindow();var r=jQuery("#mapp_e_top_toolbar").outerHeight(),u=jQuery("#mapp_edit").outerHeight();jQuery("#mapp_e_poi_list").height(r+u)};l.apply(this)}